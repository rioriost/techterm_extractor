【発明の詳細な説明】
【技術分野】
【０００１】
  本発明は、複合機などの画像処理装置に関する。
【背景技術】
【０００２】
  近年の複合機を始めとする画像処理装置では、ユーザ認証を行い、ログインしたユーザに応じて、ジョブやリソースに対するアクセス制限が可能なように構成されている装置が数多く存在する。このような画像処理装置では、あるユーザがログイン中にある操作を行い、その操作に対する実行権限が不足していた場合に、認証画面を表示し権限を有する異なるユーザでのログインを促すことが多い。
【０００３】
  このようなユーザセッション管理としては、異なるユーザでログインした時点で、ユーザに関連する全ての情報（例えば、ユーザ名やユーザのメールアドレスなどのユーザプロファイル、及びユーザ権限）が完全に切り替わる構成（以下、背景技術例１）がある。この場合、異なるユーザでログインする直前に、先にログインしていたユーザは自動でログアウトされるように構成される（例えば、特許文献１参照）。
【０００４】
  その他のユーザセッション管理としては、既にログインしているユーザ情報のうち、ユーザ名やユーザのメールアドレスなどのユーザプロファイルは切り替わらず、ユーザ権限のみが再評価される構成（以下、背景技術例２）である。この場合の再評価方法としては、先にログインしていたユーザ権限に後からログインしたユーザが持つ権限が追加されることが多い。
【先行技術文献】
【特許文献】
【０００５】
【特許文献１】 特開平１１−２５０４０号公報 
【発明の概要】
【発明が解決しようとする課題】
【０００６】
  図１６は、上記背景技術例１のユーザセッション管理を示すタイミングチャートである。
【０００７】
  図中の項目４００１は、ユーザセッションにおいて実際に適用されるユーザ名やユーザのメールアドレスなどのユーザプロファイルを表している。項目４００２は、ユーザ権限
を表している。項目４００３は、項目４００１，４００２の内容を決定するために、画像形成装置がユーザセッションに関連付けて記憶しているログインユーザ情報を表している。また、図１７は、図１６に用いられるユーザＡとユーザＢのユーザプロファイル及びユーザ権限の設定を示す表形式図である。
【０００８】
  背景技術例１によれば、時刻ｔ４０１においてログイン画面でユーザ情報を入力し、ユーザＡとしてログインする。ユーザＡは図１７の設定情報によりカラーコピーは許可されており、カラーコピーを実行することができる。
【０００９】
  次に、時刻ｔ４０２においてネットワーク管理機能を実行しようとするが、ユーザＡはネットワーク管理機能を禁止されているため、権限を有するユーザでの認証を求められる。ここでユーザＢの認証情報を入力することで、ユーザＡが管理者としてユーザＢでログインする。この時点で、ユーザプロファイル４００１は４０２１のようにユーザＢに、ユーザ権限４００２は４０２２のようにユーザＢの権限に変更される。
【００１０】
  次に、時刻ｔ４０３において、再度カラーコピーを実行しようとすると、ユーザＢはカラーコピーを禁止されているため、権限を有するユーザでの認証を求められ、再度ユーザＡの認証情報を入力する必要に迫られる。
【００１１】
  このように、背景技術例１は、新たなユーザのログイン時にログイン済みのユーザをログアウトさせる構成を採る。この構成では、ユーザに関連する全ての情報が切り替わるために、あるユーザとしては利用できていた機能が、異なるユーザとしてログインした時点で利用できなくなるケースが存在する。利用できなくなった機能を再び利用できるようにするには、ユーザは再度ログインを行わなければならない。その結果、何回もログインを求められるため、使い勝手が悪いという問題があった。
【００１２】
  図１８は、背景技術例２のユーザセッション管理を示すタイミングチャートである。
【００１３】
  図中の符号６００１から６００３は、図１６の符号４００１から４００３と同じ意味を表す。図１８の例における、ユーザＡとユーザＢのユーザプロファイル及びユーザ権限の設定は図１７の例と同様とする。
【００１４】
  時刻ｔ６０１において、ログイン画面でユーザ情報を入力し、ユーザＡとしてログインする。ユーザＡは、図１７の例の設定情報により、利用可能な機能としてカラーコピーが許可されており、カラーコピーを実行することができる。
【００１５】
  次の時刻ｔ６０２において、ネットワーク管理機能を実行しようとするが、ユーザＡはネットワーク管理機能を禁止されているため、権限を有するユーザでの認証を求められる。ここでユーザＢの認証情報を入力することで、ユーザＡが管理者としてユーザＢでログインする。この時点で、ユーザプロファイル６００１はユーザＡのままであるが（図１８の６０２１参照）、ユーザ権限６００２はユーザＡとユーザＢに許可されていた項目は全て許可に変更される（図１８の６０２２参照）。
【００１６】
  次の時刻ｔ６０３において、再度カラーコピーを実行しようとした場合には、ユーザＡの権限が有効であるため、再度認証画面が表示されることなく実行することができる。
【００１７】
  このように、背景技術例２では、先にログインしていたユーザまたは後からログインしたユーザのいずれかで許可されている場合は、許可とするように権限を再評価していく。このため、あるユーザとして利用できていた機能が、異なるユーザとしてログインしたとしても使えなくなることはなく、利便性は向上する。
【００１８】
  しかしながら、ユーザ名やユーザのメールアドレスなどのユーザプロファイルは、先にログインしていたユーザのユーザプロファイルのままか、後からログインしたユーザのユーザプロファイルに切り替わるかが、ユーザにとって直感的には判断しにくい。
【００１９】
  例えば、電子メール送信機能を備え、送信メールの発信者アドレスにログインユーザのメールアドレスを自動設定する画像処理装置が存在したとする。この画像処理装置にユーザＡとしてログイン中に、ある管理設定項目を変更する必要が発生し、管理者であるユーザＢとして再ログインして設定変更した後、電子メールを送信した場合、ユーザＡとユーザＢのいずれが自動設定されるかが判りにくい。これと同様な課題として、意図していないユーザの印刷ジョブとして課金されてしまう、ファクスの発信人名称が意図しない名称になってしまう、定型業務やアドレス帳などの個人データも意図しないユーザデータを参照してしまう、などが挙げられる。
【００２０】
  本発明は上記従来の問題点に鑑み、次のような、画像処理装置を提供することを目的とする。即ち、ログインしたユーザに応じて、ジョブやリソースに対するアクセス制限が可能なように構成されている装置において、ユーザの認証情報入力の回数を軽減させ、利便性を向上させるようにする。
【００２１】
  また、機能を実行するための操作が、ログイン済みのユーザのうちのいずれのユーザのユーザプロファイルを基に行われるのかについて、ユーザが容易に判断できるようにする。
【課題を解決するための手段】
【００２２】
  上記目的を達成するために、請求項１に記載の画像処理装置は、ユーザの認証を行うユーザ認証手段と、前記ユーザ認証手段でログインしたユーザに応じて所定の機能に対するアクセス制限を行う手段とを有し、ログイン済みのユーザが所定の機能を実行するため別のユーザとして多重にログインすることが可能な画像処理装置において、前記多重にログインされたユーザに関するユーザ情報をログイン毎にそれぞれ独立して管理する管理手段と、前記所定の機能を実行する時に、前記管理手段で管理されているユーザ情報を参照してログイン済みのユーザ数を確認する確認手段と、前記確認手段の確認によりログイン済みのユーザが単数であるときに、前記所定の機能の実行者として該ログイン済みのユーザを自動的に選択する手段と、前記確認手段の確認によりログイン済みのユーザが複数であるときに、前記所定の機能の実行者としてのユーザをログイン済みのユーザの中から選択させる選択手段と、を備えたことを特徴とする。
【発明の効果】
【００２３】
  本発明によれば、ユーザの認証情報入力作業の回数を軽減させ、利便性を向上させることができる。また、多重にログインされたユーザのうち、いずれのユーザに関するユーザ情報を基に所定の機能が実行されるのかについて、ユーザは容易に判断することができる。
【図面の簡単な説明】
【００２４】
【図１】実施の形態に係る画像処理装置が利用されるシステムの構成を示す模式図である。
【図２】図１中の画像処理装置のハードウェア構成を示すブロック図である。
【図３】図１中の画像処理装置のソフトウェア構成を示すブロック図である。
【図４】第１の実施の形態のユーザセッション管理を示すタイミングチャートである。
【図５】ログイン画面を示す図である。
【図６】第１の実施の形態で用いるメニュー画面を示す図である。
【図７】第１の実施の形態で用いる、権限不足時に表示されるログイン画面を示す図である。
【図８】実行ユーザ選択画面を示す図である。
【図９】第１の実施の形態に係る特徴的な処理を示すフローチャートである。
【図１０】第２の実施の形態に係るユーザセッション管理を示すタイミングチャートである。
【図１１】図１０に用いられるユーザプロファイル及びユーザ権限の設定を示す表形式図である。
【図１２】第２の実施の形態で用いるメニュー画面である。
【図１３】第２の実施の形態で用いる、権限不足時に表示されるログイン画面を示す図である。
【図１４】第２の実施の形態で用いるエラー画面を示す図である。
【図１５】第２の実施の形態に係る処理を示すフローチャートである。
【図１６】背景技術例１のユーザセッション管理を示すタイミングチャートである。
【図１７】図１６に用いられるユーザプロファイル及びユーザ権限の設定を示す表形式図である。
【図１８】背景技術例２のユーザセッション管理を示すタイミングチャートである。
【発明を実施するための形態】
【００２５】
  以下、本発明の実施の形態について、図面を参照しながら説明する。
【００２６】
    ［第１の実施の形態］
  ＜システム構成＞
  図１は、本発明の実施の形態に係る画像処理装置が利用されるシステムの構成を示す模式図である。
【００２７】
  このシステムは、ネットワーク上で接続されたサーバ用ＰＣ（パーソナルコンピュータ）１０００、ユーザ情報用サーバ装置１００１、チケット発行用サーバ装置１００２、クライアントＰＣ１００３、及び画像処理装置１００４から構成されている。そして、このシステムは、デバイスを利用するユーザのアクセス制限、及び印刷枚数等のジョブ実行制限を行う印刷管理システムである。なお、ここでのユーザとは、個人ユーザ、部門、組織等を含む。
【００２８】
  サーバ用ＰＣ１０００は、システム管理者ユーティリティが動作し、本システムの設定・管理を行う。特に、ユーザ情報用サーバ装置１００１の機能制限情報（以下、ＡＣＥ）の設定を行うことができる。ユーザ情報用サーバ装置１００１には、ユーザＩＤとパスワードといったユーザ情報、さらにはシステムにおいてユーザ毎やデバイス毎にどの機能の使用が許可されているかというＡＣＥの集合である機能制限情報リスト（以下、ＡＣＬ）が保持されている。
【００２９】
  チケット発行用サーバ装置１００２は、ユーザ情報用サーバ装置１００１に格納されているＡＣＬに基づいて、使用可能な機能についての情報を記述したチケットを発行する。クライアントＰＣ１００３は、プリンタドライバが動作すると共に、当該クライアントＰＣを使用する際には、どのユーザが当該クライアントＰＣを使用しているのかを明らかにするためにログインが必要であるものとする。
【００３０】
  画像処理装置１００４は、例えば多機能複写機である。画像処理装置１００４は、紙原稿を複写する機能のみならず、外部のプリンタドライバから送付された印刷データを印刷する機能、紙原稿を読み込みその画像データを外部のファイルサーバ或いはメールアドレス宛に送信する機能（ＳＥＮＤ機能）も持つ。さらには、他の画像処理装置にデータを送
信して、送信先の画像処理装置で印刷する機能（リモートコピー機能、ファクシミリ機能）なども持つ。
【００３１】
  ＡＣＴは、Ａｃｃｅｓｓ  Ｃｏｎｔｒｏｌ  Ｔｏｋｅｎの略語である。ＡＣＴ１００５は、ユーザが画像処理装置１００４において実行可能な機能についての情報や、画像処理装置１００４への機能制限情報が記載されており、これらの情報をサーバからデバイスへ伝達する役割を持つデータである。
【００３２】
  上記の、サーバ用ＰＣ１０００、ユーザ情報用サーバ装置１００１、チケット発行用サーバ装置１００２、及びクライアントＰＣ１００３は、不図示のイーサネット（登録商標）により接続されているものとするが、あくまでもシステムの一例である。画像処理装置１００４以外のサーバ用ＰＣ１０００、ユーザ情報用サーバ装置１００１，チケット発行用サーバ装置１００２，クライアントＰＣ１００３は全て同一のコンピュータで構成できても良い。さらにサーバ用ＰＣ１０００、ユーザ情報用サーバ装置１００１，チケット発行用サーバ装置１００２，クライアントＰＣ１００３を画像処理装置１００４に実装し、画像処理装置１００４のみで構成できても良い。
【００３３】
  ＜画像処理装置のハードウェア構成＞
  図２は、図１中の画像処理装置１００４のハードウェア構成を示すブロック図である。
【００３４】
  コントローラユニット２０００は、画像入力デバイスであるスキャナ２０７０や画像出力デバイスであるプリンタ２０９５と接続し、一方ではネットワーク１００８や公衆回線１００９と接続することで、画像情報やデバイス情報の入出力を行う。ＣＰＵ２００１はシステム全体を制御するコントローラである。ＲＡＭ２００２はＣＰＵ２００１が動作するためのシステムワークメモリであり、画像データを一時記憶するための画像メモリでもある。ＲＯＭ２００３はブートＲＯＭであり、システムのブートプログラムが格納されている。ＨＤＤ２００４はハードディスクドライブであり、システムソフトウェア、アプリケーション、画像データを格納する。
【００３５】
  操作部Ｉ／Ｆ２００６は、タッチパネルを有した操作部２０１２とのインターフェース部であり、操作部２０１２に表示する画像データを操作部２０１２に対して出力する。また、操作部２０１２から本システム使用者が入力した情報を、ＣＰＵ２００１に伝える役割をする。Ｎｅｔｗｏｒｋ  Ｉ／Ｆ２０１０は、ネットワーク１００８に接続し、情報の入出力を行う。ＭＯＤＥＭ２０５０は公衆回線１００９に接続し、情報の入出力を行う。
【００３６】
  ＳＲＡＭ２１００は高速動作可能な不揮発性の記録媒体である。ＲＴＣ２１１０は、リアルタイムクロックであり、コントローラユニット２０００に電源が入っていない状態でも現在の時刻をカウントし続ける処理を行う。以上のデバイスがシステムバス２００７上に配置される。
【００３７】
  Ｉｍａｇｅ  Ｂｕｓ  Ｉ／Ｆ２００５はシステムバス２００７と画像データを高速で転送する画像バス２００８を接続し、データ構造を変換するバスブリッジである。画像バス２００８は、ＰＣＩバスまたはＩＥＥＥ１３９４で構成される。画像バス２００８上には以下のデバイスが配置される。  
【００３８】
  ＲＩＰ２０６０はラスターイメージプロセッサでありＰＤＬコードをビットマップイメージに展開する。デバイスＩ／Ｆ部２０２０は、画像入出力デバイスであるスキャナ２０７０やプリンタ２０９５とコントローラユニット２０００を接続し、画像データの同期系／非同期系の変換を行う。スキャナ画像処理部２０８０は、入力画像データに対し補正、加工、編集を行う。プリンタ画像処理部２０９０は、プリント出力画像データに対して、
プリンタの補正、解像度変換等を行う。画像回転部２０３０は画像データの回転を行う。画像圧縮部２０４０は、圧縮伸張処理を行う。
【００３９】
  ＜画像処理装置のソフトウェア構成＞
  図３は、図１中の画像処理装置１００４のソフトウェア構成を示すブロック図である。
【００４０】
  このソフトウェアは、画像処理装置１００４に内蔵されるコントローラユニット２０００に実装されるものである。画像処理装置１００４に内蔵されコントローラユニット２０００によって処理されるソフトウェアは、いわゆるファームウェアとして実装されており、ＣＰＵ２００１によって実行される。
【００４１】
  リアルタイムＯＳ３００１はリアルタイムオペレーティングシステムであり、組み込みシステムの制御に最適化された各種資源管理のサービスと枠組みを、その上で動作するソフトウェアのために提供する。
【００４２】
  コントローラプラットフォーム３００２は、ファイルシステム３００３やジョブ・デバイス制御３００４、カウンタ３００５から構成される。ファイルシステム３００３はＨＤＤ２００４やＲＡＭ２００２などの記憶装置上に構築されたデータを格納するための機構である。ジョブ・デバイス制御３００４は、画像処理装置１００４のハードウェアを制御し、また、画像処理装置１００４の主にハードウェアが提供する基本機能（プリント、スキャン、通信、画像変換など）を利用するジョブを制御する。カウンタ３００５はＳＲＡＭ２１００に格納される、アプリケーション毎の有効期限や、プリント、スキャンのカウンタ値を管理する。
【００４３】
  システムサービス３００６は、画像処理装置１００４の稼動状況をモニタリングすることや、ネットワーク１００８を介してソフトウェア配信サーバ１００６から、ソフトウェアやライセンスをダウンロードするためのモジュールである。
【００４４】
  アプリケーションプラットフォーム３００７は、リアルタイムＯＳ３００１、コントローラプラットフォーム３００２の機構を、システムアプリケーション３００８や、追加可能なアプリケーション３０１２から利用可能とするためのミドルウェアである。システムアプリケーション３００８は、アプリケーション管理３００９、ユーザセッション管理３０１０及びアクセス管理３０１１から構成される。
【００４５】
  アプリケーション管理３００９は、アプリケーション３０１２をインストール、アンインストール、起動、停止するための管理モジュールである。ユーザセッション管理３０１０は、多重にログインされたユーザに関するユーザ情報をログイン毎にそれぞれ独立して管理するモジュールである。即ち、ユーザのログイン・ログアウトに応じて、ユーザプロファイルやユーザ権限を管理するモジュールである。アクセス管理３０１１は、各種ジョブやリソースへのアクセスを、ユーザセッション管理３０１０のユーザ権限に基づきながら許可、禁止するためのセキュリティモジュールである。
【００４６】
  アプリケーション３０１２は、アプリケーションプラットフォーム３００７によって提供される機能を利用して、様々なビジネスモデルを実現する応用ソフトウェアである。
【００４７】
  ＜第１の実施の形態のユーザセッション管理＞
  次に、第１の実施の形態のユーザセッション管理について、図４を参照して説明する。
【００４８】
  図４は、第１の実施の形態のユーザセッション管理を示すタイミングチャートである。
【００４９】
  本実施の形態のユーザセッション管理は、ユーザセッション管理３０１０及びアクセス管理３０１１の機能として、画像処理装置１００４のＣＰＵ２００１において実行される。図４中の符号７００１から７００３は、それぞれ図１６の符号４００１から４００３と同じ意味を表す。また、ユーザＡとユーザＢのユーザプロファイル及びユーザ権限の設定は図１７で示したものと同様とする。
【００５０】
  ユーザが、時刻ｔ７０１においてログイン画面（図５）でユーザ情報を入力し、ユーザＡとしてログインするとメニュー画面（図６）が操作部２０１２に表示される。メインメニュー９０００の下部にはログインユーザ表示領域９００５が配置されており、この時点では、ユーザＡとして機能が実行されていることが表示される。ユーザＡは図１７の設定情報によりカラーコピー機能は許可されており、カラーコピー機能９００１を実行することができる。
【００５１】
  カラーコピー機能の実行終了後に、ユーザは、メニューへ戻る９００２を選択してメインメニュー９０００へ戻り、時刻ｔ７０２においてネットワーク管理機能９００３を実行しようとする。このとき、アクセス管理３０１１は、ユーザＡがネットワーク管理機能の実行を禁止されていると判断する。これを受けて、ユーザセッション管理３０１０は、権限を有するユーザでのユーザ認証を求めるログイン画面（図７）を表示する。
【００５２】
  ここでユーザが、ユーザＢの認証情報を入力することでユーザＢとして重ねてログインする。このとき、ユーザセッション管理３０１０はユーザプロファイル７００１を７０２１のようにユーザＢに、ユーザ権限７００２を７０２２のようにユーザＢの権限に変更する。但し、ユーザＡに関連する情報は、破棄も変更も行わず、ログインユーザ情報７００３において保持し続ける。併せて、ログインユーザ表示領域９００５の表示を次のように変更する。即ち、多重にログインされたユーザＡ，Ｂのうち、当該ネットワーク管理機能がユーザＢとして実行されていることを表示する。
【００５３】
  ネットワーク管理機能の実行終了後に、ユーザは、メニューへ戻る９００２を選択してメインメニュー９０００へ戻り、時刻ｔ７０３において再度カラーコピー機能９００１を実行しようとする。このとき、アクセス管理３０１１はログイン済みのユーザとしてはユーザＡのみが許可されていると判断する。これを受けてユーザセッション管理３０１０は、ログインユーザ情報７００３において保持していたユーザＡに関連する情報を基に、ユーザプロファイル７００１を７０２３のようにユーザＡに、ユーザ権限７００２を７０２４のようにユーザＡの権限に変更する。併せて、ログインユーザ表示領域９００５の表示を再度、次のように変更する。即ち、多重にログインされたユーザＡ，Ｂのうち、当該ネットワーク管理機能がユーザＡとして実行されていることを表示する。
【００５４】
  カラーコピー機能の実行終了後に、ユーザは、メニューへ戻る９００２を選択してメインメニュー９０００へ戻り、時刻ｔ７０４において、ファクス機能９００４を実行しようとする。このとき、アクセス管理３０１１は、ログイン済みのユーザＡ、ユーザＢとも許可されていると判断する。これを受けてユーザセッション管理３０１０は、実行ユーザ選択画面（図８の９０６０）を表示する。ユーザが、ファクス機能９００４を実行する実行者である実行ユーザとして例えばユーザＢを選択したとする。この場合には、ユーザセッション管理３０１０は、ログインユーザ情報７００３において保持されていたユーザＢに関連する情報を基に、次のような処理を行う。即ち、ユーザプロファイル７００１は７０２５のようにユーザＢに、ユーザ権限７００２は７０２６のようにユーザＢの権限に再度変更する。併せて、ログインユーザ表示領域９００５の表示を再度、次のように変更する。即ち、多重にログインされたユーザＡ，Ｂのうち、当該ネットワーク管理機能がユーザＢとして実行されていることを表示する。
【００５５】
  一方、ファクス機能９００４を実行するユーザとしてユーザＡを選択した場合には、ユーザプロファイル７００１及びユーザ権限７００２の内容、並びにログインユーザ表示領域９００５の表示について、いずれも変更しない。
【００５６】
  ＜第１の実施の形態に係る特徴的な処理＞
  次に、第１の実施の形態に係る特徴的な処理について、図９を参照して説明する。
【００５７】
  図９は、第１の実施の形態に係る特徴的な処理を示すフローチャートである。この処理は、機能選択時に実行ユーザ情報を自動で決定、またはユーザ選択に応じて決定する処理であり、ユーザセッション管理３０１０、アクセス管理３０１１の機能として、画像処理装置１００４のＣＰＵ２００１において実行される。
【００５８】
  ユーザがステップＳ１２１において機能を選択すると、アクセス管理３０１１は、次のステップＳ１２２において前記選択した機能の実行を許可されているログイン済みのユーザが、複数か否かを確認する。ユーザ数が複数でない場合には、ユーザセッション管理３０１０は、ステップＳ１２３において許可されている唯一のユーザを実行ユーザとして自動的に選択する。そして、次のステップＳ１２６へ進む。
【００５９】
  前記選択した機能の実行を許可されているログイン済みのユーザ数が複数である場合は、ユーザセッション管理３０１０は、ステップＳ１２４において実行ユーザ選択画面（図８）を表示する。そして、続くステップＳ１２５においてユーザが選択した結果を受信し、これに基づき、前記選択した機能の実行ユーザを決定する。そして、次のステップＳ１２６へ進む。
【００６０】
  上記から、ステップＳ１２２からステップＳ１２３を経てステップＳ１２６へ至るフローの処理は、要するに次のような処理である。即ち、ログイン済みのユーザが複数であっても、前記選択した機能の実行を許可されているユーザが単数の場合には、ログイン済みのユーザのリストからの再選択を促すことなく、当該ユーザを前記選択した機能の実行ユーザとして自動的に選択する。
【００６１】
  次に、ユーザセッション管理３０１０は、ステップＳ１２６において上記の手順で決定された実行ユーザが現在の実行ユーザと同じであるか否かを判断する。同じである場合はそのままステップＳ１２９へ進み、アプリケーション３０１２が前記選択した機能を実行する。同じでない場合は、ユーザセッション管理３０１０は、ステップＳ１２７においてユーザプロファイルを前記決定された実行ユーザに変更し、さらにステップＳ１２８においてユーザ権限を前記決定された実行ユーザに変更する。そして、ステップＳ１２９において前記選択した機能を実行する。
【００６２】
  ＜第１の実施の形態に係る利点＞
  本実施の形態によれば、ログインしたユーザに応じて、ジョブやリソースに対するアクセス制限が可能なように構成されている装置において、ユーザの認証情報入力作業の回数を軽減させ、利便性を向上させることができる。
【００６３】
  また、ログインユーザ表示領域を設け、所定の機能がログイン済みのユーザのうちのいずれのユーザとして実行されるのかを表示するようにした。これにより、機能を実行するための操作が、ログイン済みのユーザのうちのいずれのユーザのユーザプロファイルを基に行われるのかについて、ユーザは容易に判断することができる。
【００６４】
    ［第２の実施の形態］
  次に、本発明の第２の実施の形態について説明する。
【００６５】
  この第２の実施の形態の基本的な構成は、上記第１の実施の形態における図１、図２及び図３で説明したものと同様である。以下、第２の実施の形態に特徴的な部分について説明する。
【００６６】
  ＜第２の実施の形態のユーザセッション管理＞
  図１０は、本発明の第２の実施の形態に係るユーザセッション管理を示すタイミングチャートである。
【００６７】
  本実施の形態のユーザセッション管理は、ユーザセッション管理３０１０、及びアクセス管理３０１１の機能として、画像処理装置１００４のＣＰＵ２００１において実行される。図１０の符号５００１から５００３までは、それぞれ図１６の符号４００１から４００３までと同じ意味を表す。
【００６８】
  図１１は、図１０に用いられるユーザＡとユーザＢのユーザプロファイル及びユーザ権限の設定を示す表形式図である。
【００６９】
  この図１１に示す例は、第１の実施の形態で用いた図１７の例とは異なり、ユーザプロファイルとして、ユーザのタイプ（種別）を示すユーザタイプ情報８００１が登録されている。ユーザタイプには、例えば、匿名ユーザと実名ユーザが存在する。匿名ユーザは、不特定多数の人間によって利用される特別なユーザであり、ユーザの名称に関するユーザ名情報やメールアドレスなどのユーザ特定要素を持たない。実名ユーザは、これらユーザ特定要素を持つユーザである。
【００７０】
  ユーザが、時刻ｔ８０１においてログイン画面（図５）でユーザ情報を入力し、匿名ユーザとしてログインすると、メニュー画面（図１２）が操作部２０１２に表示される。メニュー９０１０の下部にはログインユーザ表示領域９０１５が配置されており、この時点では匿名ユーザとして機能が実行されていることが表示される。匿名ユーザは、図１１の設定情報によりカラーコピー機能は許可されており、カラーコピー機能９０１１を実行することができる。なお、匿名ユーザでのログインは画像処理装置１００４の起動時に自動で行われても構わない。
【００７１】
  カラーコピー機能の実行終了後に、ユーザは、メニューへ戻る９０１２を選択してメインメニュー９０１０へ戻り、時刻ｔ８０２においてネットワーク管理機能９０１３を実行しようとする。このとき、アクセス管理３０１１は、匿名ユーザがネットワーク管理機能を禁止されていると判断する。そして、ユーザセッション管理３０１０は権限を有するユーザでの認証を求めるログイン画面（図１３の９０７０）を表示する。ここでユーザが、ユーザＢの認証情報を入力することでユーザＢとして重ねてログインする。このとき、ユーザセッション管理３０１０は、ユーザプロファイル５００１を図１０の５０２１のようにユーザＢに変更し、ユーザ権限５００２を図１０の５０２２のように、匿名ユーザとユーザＢに許可されていた項目を全て許可に変更する。併せてログインユーザ表示領域９０１５を、ユーザＢとして実行されていることが表示されるように変更する。
【００７２】
  ネットワーク管理機能の実行終了後に、ユーザはメニューへ戻る９０１２を選択してメインメニュー９０１０へ戻り、時刻ｔ８０３において、再度カラーコピー機能を実行しようとする。このとき、アクセス管理３０１１は、図１０の５０２２に示すユーザ権限５００２を参照して、カラーコピー機能が許可されていると判断する。その結果、再度認証画面を表示することなく、カラーコピー機能を実行することができ、ログインユーザ表示領域９０１５も変更なく、ユーザＢとして実行されていることが表示される。
【００７３】
  再度のカラーコピー機能の実行終了後に、ユーザは、メニューへ戻る９０１２を選択してメインメニュー９０１０へ戻り、時刻ｔ８０４においてファクス機能９０１４を実行するとする。このとき、アクセス管理３０１１は、図１０の５０２２に示すユーザ権限を参照し、ファクス機能９０１４が許可されてないと判断する。このとき、ユーザセッション管理３０１０はユーザ変更の不可を通知するエラー画面（図１４）を表示する。第２の実施の形態では、実名ユーザでログインしている場合には更なる認証を禁止しているためであり、ユーザプロファイル５００１及びユーザ権限５００２が変更されることはない。
【００７４】
  なお、ログイン画面（図５）でユーザ情報を入力する際に、実名ユーザであるユーザＡとしてログインし、ネットワーク管理機能９０１３を実行しようとした場合も同様に、ユーザ変更の不可を通知するエラー画面（図１４）を表示する。
【００７５】
  ＜第２の実施の形態に係る特徴的な処理＞
  次に、第２の実施の形態に係る特徴的な処理について、図１５を参照して説明する。
【００７６】
  図１５は、第２の実施の形態に係る処理を示すフローチャートである。この処理は、権限不足時にログイン済みのユーザタイプに応じて再度認証させるか否かを判断する処理であり、ユーザセッション管理３０１０、アクセス管理３０１１の機能として、画像処理装置１００４のＣＰＵ２００１において実行される。
【００７７】
  ユーザがステップＳ１３１において機能を選択すると、アクセス管理３０１１は、ステップＳ１３２において、ログイン済みのユーザが前記選択した機能の実行を許可されているかを判断する。許可されていると判断した場合は、ステップＳ１４１に進み、アプリケーション３０１２が前記選択した機能を実行する。一方、許可されてないと判断した場合は、ユーザセッション管理３０１０は、ステップＳ１３３においてログイン中ユーザが匿名ユーザであるかを判断する。匿名ユーザでない場合はステップＳ１３４へ進み、エラー画面（図１４）を表示する。
【００７８】
  一方、ログイン中ユーザが匿名ユーザであると判断した場合は、ステップＳ１３５へ進み、ログイン画面（例えば図１３の９０７０）を表示し、ステップＳ１３６においてユーザから認証情報の入力を受信する。ステップＳ１３７において受信した認証情報が正しいかを判断し、正しくない場合はステップＳ１３５に戻り前記ステップＳ１３５、ステップＳ１３７の手順を繰り返す。一方、受信した認証情報が正しい場合、アクセス管理３０１１は、ステップＳ１３８において受信した認証情報に対して前記選択した機能の実行が許可されているかを判断する。許可されていない場合はステップＳ１３５に戻り前記ステップＳ１３５からステップＳ１３８の手順を繰り返す。
【００７９】
  一方、前記選択した機能の実行が許可されている場合、ユーザセッション管理３０１０は、ステップＳ１３９においてユーザプロファイルを新たにログインしたユーザで上書きする。続いてステップＳ１４０においてユーザ権限情報をマージし、ステップＳ１４１において前記選択した機能を実行する。
【００８０】
  ＜第２の実施の形態に係る利点＞
  ログイン済みのユーザとして、匿名ユーザと実名ユーザが合成されるような場合であっても、上記第１の実施の形態と同等の利点を有する。
【００８１】
  なお、本発明の目的は、以下の処理を実行することによっても達成される。即ち、上述した実施の形態の機能を実現するソフトウェアのプログラムコードを記録した記憶媒体を、システム或いは装置に供給し、そのシステム或いは装置のコンピュータ（またはＣＰＵやＭＰＵ等）が記憶媒体に格納されたプログラムコードを読み出す処理である。
【００８２】
  この場合、記憶媒体から読み出されたプログラムコード自体が前述した実施の形態の機能を実現することになり、そのプログラムコード及び該プログラムコードを記憶した記憶媒体は本発明を構成することになる。
【００８３】
  また、プログラムコードを供給するための記憶媒体としては、次のものを用いることができる。例えば、フロッピー（登録商標）ディスク、ハードディスク、光磁気ディスク、ＣＤ−ＲＯＭ、ＣＤ−Ｒ、ＣＤ−ＲＷ、ＤＶＤ−ＲＯＭ、ＤＶＤ−ＲＡＭ、ＤＶＤ−ＲＷ、ＤＶＤ＋ＲＷ、磁気テープ、不揮発性のメモリカード、ＲＯＭ等である。または、プログラムコードをネットワークを介してダウンロードしても良い。
【００８４】
  また、コンピュータが読み出したプログラムコードを実行することにより、上記実施の形態の機能が実現される場合も本発明に含まれる。加えて、そのプログラムコードの指示に基づき、コンピュータ上で稼動しているＯＳ（オペレーティングシステム）等が実際の処理の一部または全部を行い、その処理によって前述した実施形態の機能が実現される場合も含まれる。
【００８５】
  更に、前述した実施形態の機能が以下の処理によって実現される場合も本発明に含まれる。即ち、記憶媒体から読み出されたプログラムコードが、コンピュータに挿入された機能拡張ボードやコンピュータに接続された機能拡張ユニットに備わるメモリに書き込まれる。その後、そのプログラムコードの指示に基づき、その機能拡張ボードや機能拡張ユニットに備わるＣＰＵ等が実際の処理の一部または全部を行う場合である。
【符号の説明】
【００８６】
  １００３  クライアントＰＣ
  １００４  画像処理装置
  ２００１  ＣＰＵ
  ２００２  ＲＡＭ
  ２００３  ＲＯＭ
  ２０１２  操作部